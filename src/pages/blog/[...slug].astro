---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => !data.draft);
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const parseDate = (date: string) => new Date(date + 'T12:00:00');

const formatDate = (date: string) => {
  const d = parseDate(date);
  return d.toLocaleDateString('es-GT', {
    weekday: 'long',
    day: 'numeric',
    month: 'long',
    year: 'numeric'
  });
};
---

<Layout
  title={`${post.data.title} | the502project`}
  description={post.data.description}
  lang="es"
>
  <div class="min-h-screen grid-bg">
    <nav class="hidden lg:flex fixed left-8 top-1/2 -translate-y-1/2 flex-col gap-4 z-50">
      <a href="/blog" class="group flex items-center gap-3">
        <span class="relative w-2 h-2 flex items-center justify-center">
          <span class="absolute w-1.5 h-1.5 rounded-full bg-gray-600 group-hover:opacity-0 transition-opacity"></span>
          <svg class="absolute w-3 h-3 text-502-green opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
        </span>
        <span class="text-xs text-gray-500 group-hover:text-502-green transition-colors">blog</span>
      </a>
      <a href="#contenido" class="nav-item group flex items-center gap-3">
        <span class="nav-indicator"></span>
        <span class="text-xs text-gray-500 group-hover:text-502-green transition-colors">contenido</span>
      </a>
    </nav>

    <div class="fixed top-0 left-0 right-0 z-50 px-6 py-4 flex items-center justify-end">
      <div class="flex items-center gap-4 text-xs text-gray-500">
        <a href="/" class="hover:text-white">inicio</a>
        <a href="/events" class="hover:text-white">eventos</a>
        <a href="/blog" class="hover:text-white">blog</a>
        <a href={`/en/blog/${post.slug}`} class="hover:text-502-green border-l border-white/10 pl-4">en</a>
      </div>
    </div>

    <main class="max-w-4xl mx-auto px-6 lg:px-0 lg:ml-44 xl:ml-56">
      <div class="grid lg:grid-cols-[1fr_260px] lg:gap-12">
        <div>
          <section id="contenido" class="min-h-screen flex flex-col justify-center py-20">
            <div class="fade-in">
              <a href="/blog" class="inline-flex items-center gap-2 text-gray-500 hover:text-502-green text-sm mb-8">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                todos los artículos
              </a>

              {post.data.image && (
                <div class="mb-10 rounded overflow-hidden border border-white/10 aspect-[2/1] sm:aspect-[21/9]">
                  <img
                    src={post.data.image}
                    alt=""
                    class="w-full h-full object-cover"
                  />
                </div>
              )}

              <div class="flex flex-wrap items-center gap-3 text-sm text-gray-500 mb-6">
                {post.data.authorUrl ? (
                  <a href={post.data.authorUrl} target="_blank" rel="noopener noreferrer" class="hover:text-502-green transition-colors">
                    {post.data.author}
                  </a>
                ) : (
                  <span>{post.data.author}</span>
                )}
                <span>·</span>
                <time datetime={post.data.pubDate}>{formatDate(post.data.pubDate)}</time>
              </div>

              <h1 class="text-3xl sm:text-4xl md:text-5xl mb-8 leading-tight">
                {post.data.title}
              </h1>

              <div class="blog-article-prose prose prose-invert prose-gray max-w-none
                prose-headings:text-white prose-headings:font-normal
                prose-p:text-gray-400 prose-p:leading-relaxed
                prose-li:text-gray-400
                prose-strong:text-white
                prose-a:text-502-green prose-a:no-underline hover:prose-a:underline
                prose-hr:border-white/10
                prose-h2:text-2xl prose-h2:sm:text-3xl prose-h2:font-normal
              ">
                <Content />
              </div>

              {post.data.authorUrl && (
                <div class="mt-12 pt-10 border-t border-white/10">
                  <p class="text-gray-400 text-sm mb-4">Conectar con la autora</p>
                  <a
                    href={post.data.authorUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="inline-flex items-center gap-3 px-5 py-3.5 bg-white/5 border border-white/20 hover:border-502-green hover:bg-502-green/10 text-white rounded transition-colors"
                  >
                    <svg class="w-5 h-5 text-502-green" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                      <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                    <span>LinkedIn · {post.data.author}</span>
                    <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                    </svg>
                  </a>
                </div>
              )}
            </div>
          </section>
        </div>

        <aside class="hidden lg:block relative">
          <div class="sticky top-0 h-screen flex items-center py-8">
            <div class="space-y-6 w-full">
              <div class="border border-white/10 p-5">
                <span class="text-[10px] uppercase tracking-wider text-gray-500 block mb-3">autor</span>
                {post.data.authorUrl ? (
                  <a href={post.data.authorUrl} target="_blank" rel="noopener noreferrer" class="text-white text-sm hover:text-502-green transition-colors">
                    {post.data.author}
                  </a>
                ) : (
                  <span class="text-white text-sm">{post.data.author}</span>
                )}
              </div>
              <div class="border border-white/10 p-5">
                <span class="text-[10px] uppercase tracking-wider text-gray-500 block mb-3">publicado</span>
                <time datetime={post.data.pubDate} class="text-gray-300 text-sm">{formatDate(post.data.pubDate)}</time>
              </div>
            </div>
          </div>
        </aside>
      </div>

      <footer class="py-16 border-t border-white/5">
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-6">
          <div class="flex items-center gap-2">
            <svg class="w-5 h-5 text-502-green" viewBox="0 0 100 100" fill="currentColor">
              <rect x="10" y="10" width="35" height="35" rx="2"/>
              <path d="M55 10 Q90 10 90 45 L55 45 Z"/>
              <path d="M10 55 Q10 90 45 90 L45 55 Z"/>
              <path d="M55 55 Q90 55 90 90 L55 90 Z"/>
            </svg>
            <span class="text-xs text-gray-500">the502project</span>
          </div>
          <div class="flex flex-wrap gap-4 text-xs text-gray-500">
            <a href="/code" class="hover:text-502-green">código de conducta</a>
            <a href="mailto:hello@the502project.com" class="hover:text-502-green">contacto</a>
          </div>
        </div>
      </footer>
    </main>
  </div>

  <script>
    const sections = document.querySelectorAll('section[id]');
    const navItems = document.querySelectorAll('.nav-item');
    window.addEventListener('scroll', () => {
      let current = '';
      sections.forEach(section => {
        if (scrollY >= section.offsetTop - 300) current = section.getAttribute('id') || '';
      });
      navItems.forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('href') === `#${current}`) item.classList.add('active');
      });
    });
  </script>
</Layout>
